<!DOCTYPE html>
<html lang="eng">
	<head>
		{% load static %}
		<title>{{ meta.title }}</title>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content='{{ meta.description }}' />
		<meta property="og:title" content="{{ meta.title }}" />
		<meta property="og:image" content="{{ BASE_URL }}{{ meta.image }}" />
		<meta property="og:description" content="{{ meta.description }}">
		<meta property="og:url" content="{{ BASE_URL }}{{ request.get_full_path }}">
		<!-- Twitter -->
		<meta name="twitter:card" content="summary_large_image">
		<meta name="twitter:site" content="@treetrnk">
		<meta name="twitter:title" content='{{ meta.title }}'>
		<meta name="twitter:description" content="{{ meta.description }}">
		<meta name="twitter:image:src" content="{{ BASE_URL }}{{ meta.image }}">
		<meta name="twitter:creator" content="@treetrnk">
		<!-- Google+ -->
		<meta itemprop="name" content='{{ meta.title }}'>
		<meta itemprop="description" content='{{ meta.description }}'>
		<meta itemprop="image" content='{{ BASE_URL }}{{ meta.image }}'>
		<link rel="shortcut icon" href="{{ BASE_URL }}{{ meta.favicon }}" type="image/x-icon">
		<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" media="screen">
		<link rel="stylesheet" href="{% static 'css/bootstrap-theme.min.css' %}" media="screen">
		<!--<link href="https://use.fontawesome.com/5c75cade5f.css" media="all" rel="stylesheet">-->
		<link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">	
		<link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald" rel="stylesheet">
		<style>
			body {
				font-family: "Open Sans", sans-serif;
				background: #fafafa;
				color: #333;
				margin-top: 50px;
			}
			h1,h2,h3,h4,h5,h6 {
				font-family: "Oswald", cursive;
			}
			header {
				width: 100%;
				box-shadow: 0px 3px 10px rgba(0,0,0,0.5);
				line-height: 50px;
				/*
				height: 50px;
				background: #6300a0; //purple
				background: #00bc4b; //green
				*/
				background: #222;
				color: #fff;
				z-index: 10;
				position: fixed;
				top: 0;
			}
			header h3 .fa {
				color: #268fff;
				/*
				color: #7f00ca; //purple
				-webkit-transition: all 1s ease-in-out;
    		-moz-transition: all 1s ease-in-out;
    		-o-transition: all 1s ease-in-out;
    		-ms-transition: all 1s ease-in-out;
    		transition: all 1s ease-in-out;
				*/
			}
			header h3 {
				margin: 0 7px;
				padding: 0;
				line-height: 50px;
				display: inline-block;
			}
			header h3 a:hover {
				text-decoration: none;
			}
			header a:link,
			header a:active,
			header a:visited,
			header a:hover
			{
				color: #fff;
			}
			header button.navbar-toggle span.icon-bar {
				color: #fff;
				background: #fff;
			}
			header .nav a:hover,
			header .nav .open > a,
			header .nav .open > a:hover,
			header .nav .open > a:focus {
				background: #555;
			}
			header ul li ul.dropdown-menu {
				background: #333;
			}
			header ul li ul.dropdown-menu li a:hover {
				color: #fff;
			}
			div.navbar-header {
				height: 50px;
			}
			/*
			header ul li ul li a {
				color: #333 !important;
			}
			*/
			/*
			header nav a {
				margin-left: 15px;
			}
			*/
			.post-content {
				background: #fff;
				box-shadow: 0px 3px 10px rgba(0,0,0,0.5);
				/*
				color: #000;
				*/
				z-index: 5;

			}
			.post-content .img-thumbnail,
			.post-content .thumbnail {
				margin: 15px;
			}
			.post-banner {
				width: 100%;
				height: 55vh;
				min-height: 200px;
			}
			.brick {
				background: #fff;
				position: absolute;
				/*
				background: #ccc;
				border: 1px solid #000;
				padding: 20px;
				*/
				width: 390px;
				box-shadow: 3px 3px 5px rgba(0,0,0,0.5);
				/*
				-webkit-transition: all 0.7s ease-in-out;
    		-moz-transition: all 0.7s ease-in-out;
    		-o-transition: all 0.7s ease-in-out;
    		-ms-transition: all 0.7s ease-in-out;
    		transition: all 0.7s ease-in-out;
				*/
			}
			.label {
				margin-bottom: 15px;
			}
			.thumbnail .caption h3 {
				margin: 10px 0;
			}
			.rotate {
				-ms-transform: rotate(360deg); /* IE 9 */
				-webkit-transform: rotate(360deg); /* Chrome, Safari, Opera */
				transform: rotate(360deg);
				transition-duration: 1s;
			}
			.content img {
				max-width: 95%;
			}
			.mobile-thumbnail {
				width: 104px;
				height: 104px;
				margin-right: 7px;
			}
			.brick .caption {
				min-height: 104px;
			}
			.brick .caption h3 {
				margin-top: 0;
			}
			.zoom-img {
				cursor: pointer;
				cursor: -moz-zoom-in; 
				cursor: -webkit-zoom-in; 
				cursor: zoom-in;
			}
			#imageBackdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5));
        z-index: 50;
      }
      #imageViewer {
        width: 90%;
        height: 85%;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 51;
				text-align: center;
      }
			.zoomed {
				max-width: 100%; 
				max-height: 100%; 
				cursor: pointer;
				cursor: -moz-zoom-out;
				cursor: -webkit-zoom-out;
				cursor: zoom-out;
			}
			.label {
				line-height: 2.2;
			}
			#subscribe {
				position: fixed;
				bottom: 10px;
				right: 20px;
				z-index: 10;
				-webkit-transition: all 0.3s ease-in-out;
    		-moz-transition: all 0.3s ease-in-out;
    		-o-transition: all 0.3s ease-in-out;
    		-ms-transition: all 0.3s ease-in-out;
    		transition: all 0.3s ease-in-out;
			}
			#subscribe a, #subscribe button {
				box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
			}
			#subscribe #subhide {
				font-size: 15px;
				text-shadow: 0 0 2px #ffffff;
				cursor: pointer;
			}
			.text-huge {
				font-size: 60px;
			}	
			.text-lg {
				font-size: 20px;
			}	
			.wiggle {
				animation: wiggle 0.82s cubic-bezier(.36,.07,.19,.97) both;
				transform: rotate(0deg);
				backface-visibility: hidden;
				perspective: 1000px;
			}
			@keyframes wiggle {
				10%, 90% {
					transform: rotate(-5deg);
				}
				20%, 80% {
					transform: rotate(5deg);
				}
				30%, 50%, 70% {
					transform: rotate(-10deg);
				}
				40%, 60% {
					transform: rotate(10deg);
				}
			}
		</style>
	</head>
	<body>

		<header>
			<div class="container-fluid">

				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-links" aria-expanded="false">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<h3>
						<a href="/">
							<i class="fa fa-plus-square"></i>
							<i class="fa fa-square"></i>
							rpg stuff
							<i class="fa fa-minus-square"></i>
							<i class="fa fa-plus-square"></i>
						</a>
					</h3>
				</div>

				<nav class="collapse navbar-collapse" id="navbar-links">
					<ul class="nav navbar-nav">
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tools <span class="caret"></span></a>
							<ul class="dropdown-menu">
							<!--
								<li><a href="/beastiary/"><i class="fa fa-paw"></i> Beastiary</a></li>
							-->
								<li><a href="/mastersofumdaar/"><i class="fa fa-star"></i> Umdaar Character Generator</a></li>
								<li><a href="/storygen/"><i class="fa fa-book"></i> Storygen</a></li>
								<li><a href="https://drive.google.com/drive/folders/0B_UB90M1F8sqbXltZDRaUEY4NmM?usp=sharing" target="charsheets"><i class="fa fa-id-card"></i> Form-fillable Character Sheets</a></li>
								<!---
								<li><a href="/fate-charsheet/"><i class="fa fa-id-card"></i> Fate Core Charsheet</a></li>
								--->
							</ul>
						</li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Projects <span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li><a href="http://www.drivethrurpg.com/product/199567/High-Fantasy-Magic-A-Simple-Magic-System-for-Fate-Core--Accelerated" target="_blank"><i class="fa fa-magic"></i> High Fantasy Magic</a></li>
								<li><a href="http://www.drivethrurpg.com/product/233596/Fate-Character-Tents" target="_blank"><i class="far fa-newspaper fa-rotate-180"></i> Fate Character Tents</a></li>
								<li><a href="http://www.drivethrurpg.com/product/204660/Fate-NPC-Cards" target="_blank"><i class="fa fa-users"></i> Fate NPC Cards</a></li>
								<li><a href="http://www.drivethrurpg.com/product/204653/Fate-PC-Tracker" target="_blank"><i class="fa fa-list"></i> Fate PC Tracker</a></li>
								<li role="separator" class="divider"></li>
								<li><a href="http://www.drivethrurpg.com/browse/pub/10796/Nathan-Hare" target="_blank"><i class="fa fa-user-circle"></i> DriveThruRPG Publisher Page</a></li>
								<li><a href="https://nathanhare.net" target="_blank"><i class="fa fa-code"></i> Web Portfolio</a></li>
							</ul>
						</li>
						<li><a href="/about/">About</a></li>
						<li><a href="javascript:void(0)" data-toggle="modal" data-target="#searchModal"><i class="fa fa-search"></i> <span class="hidden-lg hidden-md hidden-sm">Search</span></a></li>
					</ul>

				</nav>
			</div>
		</header>

		<!---
		<section class="jumbotron">

		</section>
		--->

		<main>
			{% block content %}{% endblock %}
		</main>

		<footer>

		</footer>

		<div class="hidden" id="imageBackdrop">
			<div id="imageViewer"></div>
		</div>

		<div id="subscribe" class="text-right">
			<!--
			<span id="subHide">Close (X)</span><br />
			<div class="btn-group dropup">
			-->
			<a href="https://feedburner.google.com/fb/a/mailverify?uri=RpgStuffBlog&amp;loc=en_US" class="btn btn-lg btn-primary" target="_blank"><i class="fa fa-envelope"></i> Subscribe</a>
			<!---
			<button type="button" class="btn btn-primary btn-lg dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
			<ul class="dropdown-menu">
				<li><a href="https://feedburner.google.com/fb/a/mailverify?uri=RpgStuffBlog&amp;loc=en_US" target="_blank">All</a></li>	
				<li><a href="https://feedburner.google.com/fb/a/mailverify?uri=RpgStuffBlog&amp;loc=en_US" target="_blank">Play Reports</a></li>	
				<li><a href="https://feedburner.google.com/fb/a/mailverify?uri=RpgStuffBlog&amp;loc=en_US" target="_blank">Pregens</a></li>	
				<li><a href="https://feedburner.google.com/fb/a/mailverify?uri=RpgStuffBlog&amp;loc=en_US" target="_blank">Reviews</a></li>	
			</ul>
			</div>
			--->
		</div>

		<!-- Modal -->
		<div class="modal fade" id="searchModal" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-body text-center">
						<form class="form" action="/" method="get">
							<div class="input-group">
								<input type="text" name="search" placeholder="goblins, sharkman, dice, etc." class="form-control" id="searchInput" />
								<span class="input-group-btn">
									<button type="submit" class="btn btn-primary"><i class="fa fa-search"></i> Search</button>
								</span>
							</div>
						</form>
						<br />
						<i class="fa fa-tags"></i> <b>Tags:</b>
						{% for tag in tags %}
						<a href="/?tag={{ tag }}"><span class="label label-default">{{ tag }}</span></a>
						{% endfor %}
					</div>
				</div>
			</div>
		</div>

		<script src="{% static '/js/jquery-3.2.1.min.js' %}"></script>
		<script src="{% static '/js/bootstrap.min.js' %}"></script>
		<script src="{% static '/js/jquery.lazy.min.js' %}"></script>
		<script>
			var colCount = 0;
			var colWidth = 0;
			var defaultColWidth = 0;
			var margin = 20;
			var windowWidth = 0;
			var blocks = [];

			$(function(){
				$(window).resize(setupBlocks);
			});

			function setupBlocks() {
				windowWidth = $(window).width();
				//console.log("Window width: " + windowWidth);

				var colAmnt = Math.floor(windowWidth/(defaultColWidth));
				//console.log("Column width + margin: " + (defaultColWidth + margin));
				//console.log("Amount of columns: " + colAmnt);
				//console.log("Default column width: " + defaultColWidth);
				//console.log("Actual column width: " + Math.floor(windowWidth/colAmnt - margin * 2));

				if (windowWidth < (defaultColWidth+margin*2)*2) {
					$('.brick').width(windowWidth - margin*2);
					$('.brick').css('position', 'unset');
				} else {
					$('.brick').css('position', 'absolute');
					$('.brick').width(Math.floor(windowWidth/colAmnt - margin * 2));
					colWidth = $('.brick').outerWidth();
					//console.log("Brick outer width : " + $('.brick').outerWidth());

					blocks = [];
					console.log(blocks);
					colCount = colAmnt; //Math.floor(windowWidth/(colWidth+margin*2));
					for(var i=0;i<colCount;i++){
						blocks.push(margin);
					}
					//console.log(blocks);
					positionBlocks();
				}
			}

			function positionBlocks() {
				$('.brick').each(function(){
					var min = Array.min(blocks);
					var index = $.inArray(min, blocks);
					var leftPos = margin+(index*(colWidth+margin));
					$(this).css({
						'left':leftPos+'px',
						'top':min+'px'
					});
					blocks[index] = min+$(this).outerHeight()+margin;
				});
			}

			// Function to get the Min value in Array
			Array.min = function(array) {
					return Math.min.apply(Math, array);
			};

			function rollHeaderDice() {
				var diceClasses = [
					'fa-plus-square',
					'fa-square',
					'fa-minus-square'
				];
				var diceClassStr = diceClasses.join(" ");
				$('header .navbar-header h3 i.fa').each(function() {
					var $this = $(this);
					$this.addClass('rotate');
					var newFace = diceClasses[Math.floor(Math.random() * diceClasses.length)];
					setTimeout(function() {
						$this.removeClass(diceClassStr);
						$this.addClass(newFace);
					}, 300);
				});
				setTimeout(function() {
					$('header .navbar-header h3 i.fa').removeClass('rotate');
				}, 1001);
			}

			function closeImageViewer() {
				$('#imageBackdrop').fadeOut();
				setTimeout(function() {
					$('#imageBackdrop').addClass('hidden');
				}, 500);
			}

			function enableImageViewer() {
				$("a.zoom-img").click(function(e) {
					e.preventDefault();
					e.stopPropigation;
					var img = $(this).attr('data-src');
					//window.scroll(0,0);
					$('#imageBackdrop').removeClass('hidden').fadeIn();
					$('#imageViewer').html('<img src="' + img + '" class="zoomed" />');
				});
				$(".zoom-img").click(function(e) {
					var img = $(this).attr('src');
					//window.scroll(0,0);
					$('#imageBackdrop').removeClass('hidden').fadeIn();
					$('#imageViewer').html('<img src="' + img + '" class="zoomed" />');
				});
			}

			function loadHiddenBricks() {
				$('.brick.hidden:lt(16)').each(function() {
					$(this).fadeIn('slow');
					$(this).removeClass('hidden');
				});
				//setTimeout(function() {
					setupBlocks();
				//}, 10);
			}

			function wiggleIt(element) {
				if ($(window).height() < 700 || $(window).width() < 700) {
					element.addClass("wiggle");
					setTimeout(function() {
						element.removeClass("wiggle");
					}, 1000);
				}
			}

			function replace_brick_imgs() {
				$(".brick").each(function() {
					var img = $(this).find("img").attr("data-src");
					$(this).find("img").attr("src", img);
				});
			}

			$(document).ready(function () {
				$('.lazy').Lazy({
					effect: 'fadeIn'
				});

				var curPos = $(window).scrollTop();

				rollHeaderDice();

				defaultColWidth = $('.brick').width() + margin/2;

				setupBlocks();

				enableImageViewer();

				setTimeout(function() {
					wiggleIt($("#subscribe"));
				}, 4000);

				/*
				setInterval(function() {
					wiggleIt($("#subscribe"));
				},60000);
				*/

				$('.text-huge i.fa-minus-square').addClass('rotate');

				setTimeout(function() {
					$('.text-huge i.fa-minus-square').removeClass('rotate');
				}, 1001);

				$('.text-huge i.fa-minus-square').on('mouseleave click', function() { 
					$('.text-huge i.fa-minus-square').addClass('rotate');
					setTimeout(function() {
						$('.text-huge i.fa-minus-square').removeClass('rotate');
					}, 1001);
				})

				$('#imageViewer, #imageBackdrop, header').click(closeImageViewer);

				$('#subscribe span').click(function() {
					$('#subscribe').fadeOut();
				});

				$('.brick img').on('load', function() {
					setupBlocks();
				});

				$(window).resize(function() {
					setTimeout(function() {
						setupBlocks();
					}, 250);
				});

				if ($(window).height() == $(document).height()) {
					loadHiddenBricks();
				}

				$(window).scroll(function() {

					if ($(window).scrollTop() > curPos) {
						$('#subscribe').css({bottom: -100});
						if ($('#subscribe').hasClass("wiggle")) {
							$('#subscribe').removeClass("wiggle");
						}
					} else {
						$('#subscribe').css({bottom: 10});
							if ($(window).height() < 700 || $(window).width() < 700) {
								if (!$('#subscribe').hasClass("wiggle")) {
									$('#subscribe').addClass("wiggle");
								}
							}
					}

					if ($(window).scrollTop() + $(window).height() == $(document).height()) {
						loadHiddenBricks();
					}

					curPos = $(window).scrollTop();
				});

				$('#searchModal').on('shown.bs.modal', function () {
					$('#searchInput').focus()
				})

				$('header .navbar-header h3').mouseleave(rollHeaderDice);

				$('[data-toggle="tooltip"]').tooltip();

			});
		</script>
	</body>
</html>
